# AUTH-002: プロフィール設定画面 実装指示書

## 1. 全体評価

### 目的とゴール
- **主要目的**: 新規ユーザーのプロフィール情報設定と既存ユーザーのプロフィール更新を提供
- **ビジネスゴール**: ユーザーエンゲージメント向上とパーソナライズ機能の基盤構築
- **技術ゴール**: 直感的なUI/UXと効率的なデータ管理の実現

### 受け入れ基準
- 新規ユーザーが2分以内にプロフィール設定完了
- 既存ユーザーが1分以内にプロフィール更新完了
- 画像アップロードが30秒以内に完了
- モバイル・デスクトップ両対応のレスポンシブデザイン
- WCAG 2.1 AA準拠のアクセシビリティ

### 機能段階性
1. **基礎**: 基本情報入力、画像アップロード、バリデーション
2. **拡張**: プレビュー機能、自動保存、進捗表示
3. **制約**: ファイルサイズ制限、画像形式制限、文字数制限

## 2. 仕様の厳密化

### コア機能

#### プロフィール情報入力
- **入力項目**: 名前、年齢、趣味・興味、好み設定
- **バリデーション**: リアルタイム検証、エラーメッセージ表示
- **保存**: フォーム送信時のローディング状態表示
- **完了**: 成功時のプライバシー設定画面への遷移

#### 画像アップロード
- **対応形式**: JPEG, PNG, WebP
- **サイズ制限**: 最大5MB
- **解像度**: 推奨512x512px以上
- **プレビュー**: リアルタイムプレビュー表示

#### 設定項目表示
- **基本情報**: 名前、年齢、性別
- **趣味・興味**: 複数選択可能なタグ形式
- **好み設定**: デートの好み、予算感、時間帯

### 入力制約 & バリデーション

#### 名前
- **長さ**: 1-50文字
- **文字種**: 日本語・英数字・記号（制御文字除く）
- **必須**: 必須項目
- **エラーメッセージ**: "名前を入力してください"

#### 年齢
- **範囲**: 18-100歳
- **形式**: 数値のみ
- **必須**: 必須項目
- **エラーメッセージ**: "18歳以上100歳以下で入力してください"

#### 趣味・興味
- **選択数**: 最大10個
- **形式**: タグ形式
- **必須**: 任意項目
- **エラーメッセージ**: "10個以下で選択してください"

#### 画像ファイル
- **形式**: JPEG, PNG, WebP
- **サイズ**: 最大5MB
- **解像度**: 最小256x256px
- **エラーメッセージ**: "対応形式で5MB以下の画像を選択してください"

### データモデル & API

#### リクエストモデル
```typescript
interface ProfileUpdateRequest {
  name: string;
  age: number;
  interests: string[];
  preferences: {
    budget: 'low' | 'medium' | 'high';
    timeOfDay: 'morning' | 'afternoon' | 'evening' | 'night';
    dateType: string[];
  };
}

interface ImageUploadRequest {
  file: File;
  userId: string;
}
```

#### レスポンスモデル
```typescript
interface ProfileResponse {
  userId: string;
  name: string;
  age: number;
  interests: string[];
  preferences: UserPreferences;
  profileImage?: string;
  updatedAt: string;
}
```

#### API エンドポイント
- **プロフィール更新**: `PUT /api/v1/users/{userId}/profile`
- **画像アップロード**: `POST /api/v1/users/{userId}/avatar`
- **プロフィール取得**: `GET /api/v1/users/{userId}/profile`

### UX / A11y

#### キーボード操作
- **Tab順序**: 名前 → 年齢 → 趣味・興味 → 好み設定 → 画像アップロード → 保存ボタン
- **Enter**: フォーム送信
- **Escape**: フォームリセット
- **矢印キー**: タグ選択

#### スクリーンリーダー対応
- **aria-label**: 各入力フィールドの説明
- **aria-live**: エラーメッセージの読み上げ
- **aria-describedby**: ヘルプテキストの関連付け
- **role**: フォーム要素の役割定義

#### 色覚対応
- **エラー表示**: 色 + アイコン + テキスト
- **成功表示**: 色 + チェックマーク + テキスト
- **フォーカス**: 色 + アウトライン + 影

### セキュリティ & プライバシー

#### データ保護
- **画像**: 適切な形式検証とウイルススキャン
- **通信**: HTTPS強制、TLS 1.3以上
- **保存**: 暗号化されたストレージ
- **アクセス**: 認証済みユーザーのみ

#### 入力サニタイズ
- **XSS対策**: 入力値のエスケープ処理
- **ファイル検証**: ファイル形式とサイズの厳密な検証
- **画像処理**: メタデータの除去

### 非機能要件

#### パフォーマンス
- **初期表示**: 2秒以内
- **フォーム送信**: 3秒以内
- **画像アップロード**: 30秒以内
- **バリデーション**: 100ms以内

#### 可用性
- **稼働率**: 99.9%以上
- **エラー率**: 1%以下
- **復旧時間**: 5分以内

#### スケーラビリティ
- **同時接続**: 10,000ユーザー
- **スループット**: 1,000リクエスト/秒
- **ストレージ**: 100万ユーザー分の画像

## 3. 曖昧さと解決

### 画像アップロード
- **ドラッグ&ドロップ**: ファイルエリアへのドラッグ&ドロップ対応
- **クリック選択**: ファイル選択ダイアログの表示
- **プレビュー**: アップロード前のプレビュー表示

### 趣味・興味選択
- **タグ形式**: クリックで選択/解除
- **検索機能**: タグの検索機能
- **カスタムタグ**: 新規タグの追加機能

### 自動保存
- **デフォルト**: 自動保存無効
- **手動保存**: 保存ボタンでの明示的保存
- **下書き保存**: 一時的な下書き保存機能

## 4. 受け入れ基準例（Gherkin風）

### プロフィール設定
```gherkin
Given ユーザーがプロフィール設定画面にアクセス
When 有効な名前、年齢、趣味・興味を入力
And 保存ボタンをクリック
Then プロフィールが保存される
And プライバシー設定画面に遷移する

Given ユーザーがプロフィール設定画面にアクセス
When 無効な年齢（17歳）を入力
Then エラーメッセージが表示される
And プロフィール保存が阻止される
```

### 画像アップロード
```gherkin
Given ユーザーがプロフィール設定画面にアクセス
When 有効な画像ファイルを選択
Then プレビューが表示される
And アップロードが完了する

Given ユーザーがプロフィール設定画面にアクセス
When 5MBを超える画像ファイルを選択
Then エラーメッセージが表示される
And アップロードが阻止される
```

## 5. リスクとトレードオフ

### セキュリティリスク
- **悪意のあるファイル**: 厳密なファイル形式検証
- **画像メタデータ**: EXIFデータの除去
- **ストレージ容量**: 適切な容量制限

### UXリスク
- **複雑な入力**: 段階的な入力フォーム
- **画像アップロード**: 進捗表示とエラーハンドリング
- **バリデーション**: リアルタイムフィードバック

### パフォーマンスリスク
- **画像サイズ**: 適切な圧縮とリサイズ
- **ネットワーク**: タイムアウト設定とリトライ機能
- **メモリ使用量**: 効率的な画像処理

## 6. 拡張余地

### 短期拡張
- **ソーシャル連携**: SNSプロフィールの自動取得
- **位置情報**: 居住地域の設定
- **言語設定**: 多言語対応

### 中期拡張
- **AI提案**: 趣味・興味のAI提案
- **プロフィール分析**: プロフィール完成度の分析
- **マッチング**: 他ユーザーとのマッチング機能

### 長期拡張
- **動画プロフィール**: 動画での自己紹介
- **VR対応**: VR環境でのプロフィール設定
- **生体認証**: 顔認証による本人確認

## 7. 実装ガイドライン

### 技術スタック
- **フロントエンド**: React 18 + TypeScript + Tailwind CSS
- **状態管理**: Zustand
- **フォーム管理**: React Hook Form + Zod
- **画像処理**: Canvas API + File API
- **HTTP クライアント**: Axios

### コンポーネント設計
```typescript
// メインコンポーネント
interface ProfileFormProps {
  userId: string;
  initialData?: ProfileData;
  onSuccess: (profile: ProfileData) => void;
  onError: (error: string) => void;
}

// フォームバリデーション
const profileSchema = z.object({
  name: z.string().min(1, '名前を入力してください').max(50, '名前が長すぎます'),
  age: z.number().min(18, '18歳以上で入力してください').max(100, '100歳以下で入力してください'),
  interests: z.array(z.string()).max(10, '10個以下で選択してください'),
  preferences: z.object({
    budget: z.enum(['low', 'medium', 'high']),
    timeOfDay: z.enum(['morning', 'afternoon', 'evening', 'night']),
    dateType: z.array(z.string())
  })
});
```

### スタイリング
```css
/* レスポンシブデザイン */
.profile-container {
  @apply max-w-2xl mx-auto p-6 bg-white rounded-lg shadow-md;
}

.profile-form {
  @apply space-y-6;
}

.image-upload-area {
  @apply border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors;
}

/* ダークモード対応 */
@media (prefers-color-scheme: dark) {
  .profile-container {
    @apply bg-gray-800;
  }
  .image-upload-area {
    @apply border-gray-600 hover:border-gray-500;
  }
}
```

## 8. 日本語サンプルデータ

### ユーザープロフィールデータ
```json
{
  "userProfiles": [
    {
      "userId": "usr_001",
      "name": "山田太郎",
      "age": 28,
      "interests": ["映画鑑賞", "カフェ巡り", "読書", "旅行"],
      "preferences": {
        "budget": "medium",
        "timeOfDay": "evening",
        "dateType": ["レストラン", "映画", "散歩"]
      },
      "profileImage": "https://example.com/avatars/usr_001.jpg"
    },
    {
      "userId": "usr_002",
      "name": "佐藤花子",
      "age": 25,
      "interests": ["料理", "ヨガ", "アート", "音楽"],
      "preferences": {
        "budget": "high",
        "timeOfDay": "afternoon",
        "dateType": ["美術館", "レストラン", "カフェ"]
      },
      "profileImage": "https://example.com/avatars/usr_002.jpg"
    },
    {
      "userId": "usr_003",
      "name": "田中次郎",
      "age": 30,
      "interests": ["スポーツ", "ゲーム", "バーベキュー", "ドライブ"],
      "preferences": {
        "budget": "low",
        "timeOfDay": "morning",
        "dateType": ["公園", "スポーツ", "ドライブ"]
      },
      "profileImage": "https://example.com/avatars/usr_003.jpg"
    },
    {
      "userId": "usr_004",
      "name": "渡辺雪",
      "age": 22,
      "interests": ["写真", "インスタ映え", "ショッピング", "スイーツ"],
      "preferences": {
        "budget": "medium",
        "timeOfDay": "afternoon",
        "dateType": ["カフェ", "ショッピング", "写真スポット"]
      },
      "profileImage": "https://example.com/avatars/usr_004.jpg"
    },
    {
      "userId": "usr_005",
      "name": "鈴木明",
      "age": 35,
      "interests": ["ワイン", "グルメ", "温泉", "歴史"],
      "preferences": {
        "budget": "high",
        "timeOfDay": "evening",
        "dateType": ["レストラン", "温泉", "歴史スポット"]
      },
      "profileImage": "https://example.com/avatars/usr_005.jpg"
    },
    {
      "userId": "usr_006",
      "name": "高橋舞",
      "age": 27,
      "interests": ["ダンス", "ファッション", "コスメ", "SNS"],
      "preferences": {
        "budget": "medium",
        "timeOfDay": "evening",
        "dateType": ["クラブ", "ショッピング", "カフェ"]
      },
      "profileImage": "https://example.com/avatars/usr_006.jpg"
    },
    {
      "userId": "usr_007",
      "name": "小林健二",
      "age": 32,
      "interests": ["釣り", "キャンプ", "アウトドア", "ビール"],
      "preferences": {
        "budget": "low",
        "timeOfDay": "morning",
        "dateType": ["キャンプ", "釣り", "アウトドア"]
      },
      "profileImage": "https://example.com/avatars/usr_007.jpg"
    },
    {
      "userId": "usr_008",
      "name": "森さくら",
      "age": 24,
      "interests": ["花", "ガーデニング", "ハンドメイド", "自然"],
      "preferences": {
        "budget": "low",
        "timeOfDay": "afternoon",
        "dateType": ["公園", "植物園", "カフェ"]
      },
      "profileImage": "https://example.com/avatars/usr_008.jpg"
    },
    {
      "userId": "usr_009",
      "name": "伊藤弘",
      "age": 29,
      "interests": ["プログラミング", "技術", "ゲーム", "コーヒー"],
      "preferences": {
        "budget": "medium",
        "timeOfDay": "evening",
        "dateType": ["カフェ", "ゲームセンター", "レストラン"]
      },
      "profileImage": "https://example.com/avatars/usr_009.jpg"
    },
    {
      "userId": "usr_010",
      "name": "中村結衣",
      "age": 26,
      "interests": ["ヨガ", "瞑想", "健康", "オーガニック"],
      "preferences": {
        "budget": "medium",
        "timeOfDay": "morning",
        "dateType": ["ヨガスタジオ", "オーガニックカフェ", "公園"]
      },
      "profileImage": "https://example.com/avatars/usr_010.jpg"
    }
  ]
}
```

### 趣味・興味タグデータ
```json
{
  "interestTags": [
    "映画鑑賞", "カフェ巡り", "読書", "旅行", "料理", "ヨガ", "アート", "音楽",
    "スポーツ", "ゲーム", "バーベキュー", "ドライブ", "写真", "インスタ映え",
    "ショッピング", "スイーツ", "ワイン", "グルメ", "温泉", "歴史", "ダンス",
    "ファッション", "コスメ", "SNS", "釣り", "キャンプ", "アウトドア", "ビール",
    "花", "ガーデニング", "ハンドメイド", "自然", "プログラミング", "技術",
    "コーヒー", "瞑想", "健康", "オーガニック", "映画", "ドラマ", "アニメ",
    "漫画", "小説", "詩", "絵画", "彫刻", "陶芸", "書道", "茶道", "華道",
    "着物", "和服", "浴衣", "着付け", "日本文化", "伝統工芸", "祭り", "花火",
    "桜", "紅葉", "雪", "海", "山", "川", "湖", "滝", "温泉", "サウナ",
    "マッサージ", "エステ", "ネイル", "ヘアメイク", "美容", "ダイエット",
    "筋トレ", "ランニング", "ウォーキング", "サイクリング", "スイミング",
    "テニス", "バドミントン", "バスケットボール", "サッカー", "野球",
    "ゴルフ", "ボウリング", "ダーツ", "ビリヤード", "カラオケ", "ライブ",
    "コンサート", "演劇", "ミュージカル", "オペラ", "バレエ", "ダンス",
    "社交ダンス", "フラメンコ", "サルサ", "タンゴ", "ワルツ", "フォックストロット"
  ]
}
```

### デートタイプデータ
```json
{
  "dateTypes": [
    "レストラン", "映画", "散歩", "美術館", "カフェ", "公園", "スポーツ",
    "ドライブ", "ショッピング", "写真スポット", "温泉", "歴史スポット",
    "クラブ", "ヨガスタジオ", "オーガニックカフェ", "キャンプ", "釣り",
    "アウトドア", "植物園", "ゲームセンター", "ライブ", "コンサート",
    "演劇", "ミュージカル", "オペラ", "バレエ", "ダンス", "社交ダンス",
    "フラメンコ", "サルサ", "タンゴ", "ワルツ", "フォックストロット",
    "カラオケ", "ボウリング", "ダーツ", "ビリヤード", "ゴルフ", "テニス",
    "バドミントン", "バスケットボール", "サッカー", "野球", "スイミング",
    "サイクリング", "ランニング", "ウォーキング", "筋トレ", "ヨガ",
    "ピラティス", "エアロビクス", "ズンバ", "ボクササイズ", "キックボクシング",
    "空手", "柔道", "剣道", "弓道", "合気道", "太極拳", "気功", "瞑想",
    "座禅", "写経", "仏像巡り", "神社巡り", "お寺巡り", "パワースポット巡り",
    "聖地巡礼", "世界遺産巡り", "城巡り", "庭園巡り", "博物館巡り",
    "科学館巡り", "水族館巡り", "動物園巡り", "植物園巡り", "花見",
    "紅葉狩り", "雪見", "花火大会", "祭り", "イベント", "フェスティバル",
    "マーケット", "フリーマーケット", "蚤の市", "骨董市", "手作り市",
    "農産物直売所", "道の駅", "サービスエリア", "パーキングエリア",
    "展望台", "スカイツリー", "東京タワー", "六本木ヒルズ", "渋谷スカイ",
    "新宿都庁", "横浜ランドマークタワー", "名古屋テレビ塔", "通天閣",
    "天保山ハーバービレッジ", "USJ", "ディズニーランド", "ディズニーシー",
    "富士急ハイランド", "ナガシマスパーランド", "ひらかたパーク", "としまえん",
    "後楽園ゆうえんち", "よみうりランド", "西武園ゆうえんち", "東武動物公園",
    "多摩動物公園", "上野動物園", "サンシャイン水族館", "すみだ水族館",
    "アクアパーク品川", "マクセルアクアパーク", "新江ノ島水族館", "名古屋港水族館",
    "海遊館", "アドベンチャーワールド", "ユニバーサル・スタジオ・ジャパン"
  ]
}
```

### エラーメッセージ
```json
{
  "errorMessages": {
    "name": {
      "required": "名前を入力してください",
      "tooLong": "名前が長すぎます（50文字以内）",
      "invalid": "使用できない文字が含まれています"
    },
    "age": {
      "required": "年齢を入力してください",
      "tooYoung": "18歳以上で入力してください",
      "tooOld": "100歳以下で入力してください",
      "invalid": "正しい年齢を入力してください"
    },
    "interests": {
      "tooMany": "10個以下で選択してください",
      "invalid": "無効な趣味・興味が含まれています"
    },
    "image": {
      "required": "画像を選択してください",
      "tooLarge": "ファイルサイズが大きすぎます（5MB以内）",
      "invalidFormat": "対応形式の画像を選択してください（JPEG, PNG, WebP）",
      "tooSmall": "画像サイズが小さすぎます（256x256px以上）",
      "uploadFailed": "画像のアップロードに失敗しました"
    },
    "general": {
      "networkError": "ネットワークエラーが発生しました",
      "serverError": "サーバーエラーが発生しました",
      "timeout": "タイムアウトが発生しました",
      "unknown": "不明なエラーが発生しました"
    }
  }
}
```

### 成功メッセージ
```json
{
  "successMessages": {
    "profileSaved": "プロフィールが正常に保存されました",
    "imageUploaded": "画像が正常にアップロードされました",
    "profileUpdated": "プロフィールが正常に更新されました",
    "draftSaved": "下書きが保存されました"
  }
}
```

## 9. 最終チェックリスト

### 機能要件
- [ ] プロフィール情報入力機能が正常に動作する
- [ ] 画像アップロード機能が正常に動作する
- [ ] フォームバリデーションが適切に機能する
- [ ] エラーハンドリングが適切に実装されている
- [ ] 成功時の画面遷移が正しく動作する

### 非機能要件
- [ ] レスポンシブデザインが実装されている
- [ ] アクセシビリティ（WCAG 2.1 AA）に準拠している
- [ ] パフォーマンス要件を満たしている
- [ ] セキュリティ要件が実装されている
- [ ] エラー率が許容範囲内である

### ユーザビリティ
- [ ] 直感的なUI/UXが実装されている
- [ ] 適切なフィードバックが提供されている
- [ ] ローディング状態が適切に表示される
- [ ] エラーメッセージが分かりやすい
- [ ] キーボード操作が可能である

### セキュリティ
- [ ] 画像ファイルが適切に検証されている
- [ ] HTTPS通信が強制されている
- [ ] XSS対策が実装されている
- [ ] ファイルアップロード制限が実装されている
- [ ] 認証・認可が適切に実装されている

### データ整合性
- [ ] 入力値のサニタイズが実装されている
- [ ] バリデーションが適切に機能している
- [ ] 画像メタデータが適切に処理されている
- [ ] データ保存が安全に実装されている
- [ ] エラーログが適切に記録されている

---

**作成日**: 2025年1月27日  
**バージョン**: 1.0  
**作成者**: ソフトウェアエンジニア・UX/UIデザイナー  
**承認者**: [承認者名]  
**レビュー者**: [レビュー者名]
