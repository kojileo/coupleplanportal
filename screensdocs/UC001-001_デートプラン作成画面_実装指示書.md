# UC001-001: デートプラン作成画面 実装指示書

## 1. 全体評価

### 目的とゴール
- **主要目的**: AIを活用したパーソナライズされたデートプランの作成を提供
- **ビジネスゴール**: ユーザーエンゲージメント向上とAI機能の差別化
- **技術ゴール**: 高精度なAI提案と直感的なユーザーインターフェースの実現

### 受け入れ基準
- ユーザーが3分以内にデートプラン作成完了
- AI生成が30秒以内に完了
- 過去履歴の取得が5秒以内に完了
- モバイル・デスクトップ両対応のレスポンシブデザイン
- WCAG 2.1 AA準拠のアクセシビリティ

### 機能段階性
1. **基礎**: 基本要件入力、AI生成、プラン表示
2. **拡張**: 詳細設定、過去履歴活用、フィードバック機能
3. **制約**: 予算制限、時間制限、地域制限

## 2. 仕様の厳密化

### コア機能

#### 要件入力
- **入力項目**: 予算、時間、地域、好み、特別な要望
- **バリデーション**: リアルタイム検証、エラーメッセージ表示
- **保存**: 入力内容の一時保存
- **送信**: AI生成依頼の送信

#### ユーザープロフィール取得
- **取得**: 既存のユーザープロフィール情報
- **活用**: AI生成時の参考情報
- **更新**: プロフィール情報の更新
- **表示**: プロフィール情報の表示

#### 過去履歴取得
- **取得**: 過去のデート履歴
- **分析**: 履歴データの分析
- **活用**: AI生成時の参考情報
- **表示**: 履歴情報の表示

#### プラン生成依頼
- **送信**: AI生成依頼の送信
- **処理**: AI生成処理の開始
- **進捗**: 生成進捗の表示
- **完了**: 生成完了の通知

### 入力制約 & バリデーション

#### 予算
- **範囲**: 1,000円〜100,000円
- **形式**: 数値のみ
- **必須**: 必須項目
- **エラーメッセージ**: "1,000円以上100,000円以下で入力してください"

#### 時間
- **範囲**: 1時間〜12時間
- **形式**: 数値のみ
- **必須**: 必須項目
- **エラーメッセージ**: "1時間以上12時間以下で入力してください"

#### 地域
- **選択肢**: 都道府県・市区町村
- **必須**: 必須項目
- **エラーメッセージ**: "地域を選択してください"

#### 好み
- **選択肢**: 複数選択可能
- **最大数**: 10個
- **必須**: 任意項目
- **エラーメッセージ**: "10個以下で選択してください"

#### 特別な要望
- **長さ**: 最大500文字
- **必須**: 任意項目
- **エラーメッセージ**: "500文字以内で入力してください"

### データモデル & API

#### リクエストモデル
```typescript
interface DatePlanRequest {
  budget: number;
  duration: number; // hours
  location: {
    prefecture: string;
    city: string;
    station?: string;
  };
  preferences: string[];
  specialRequests?: string;
  coupleId: string;
  userId: string;
}

interface UserProfileRequest {
  userId: string;
}

interface DateHistoryRequest {
  coupleId: string;
  limit?: number;
  offset?: number;
}
```

#### レスポンスモデル
```typescript
interface DatePlanResponse {
  planId: string;
  status: 'generating' | 'completed' | 'failed';
  estimatedTime: number; // seconds
  createdAt: string;
}

interface UserProfileResponse {
  userId: string;
  name: string;
  age: number;
  interests: string[];
  preferences: UserPreferences;
  profileImage?: string;
}

interface DateHistoryResponse {
  dates: Date[];
  totalCount: number;
  hasMore: boolean;
}
```

#### API エンドポイント
- **プラン生成依頼**: `POST /api/v1/plans/generate`
- **プロフィール取得**: `GET /api/v1/users/{userId}/profile`
- **デート履歴取得**: `GET /api/v1/dates/history`

### UX / A11y

#### キーボード操作
- **Tab順序**: 予算 → 時間 → 地域 → 好み → 特別な要望 → 生成ボタン
- **Enter**: フォーム送信
- **Escape**: フォームリセット
- **矢印キー**: 選択肢の切り替え

#### スクリーンリーダー対応
- **aria-label**: 各入力フィールドの説明
- **aria-live**: 生成進捗の読み上げ
- **aria-describedby**: ヘルプテキストの関連付け
- **role**: フォーム要素の役割定義

#### 色覚対応
- **生成状態**: 色 + アイコン + テキスト
- **エラー表示**: 色 + 警告アイコン + テキスト
- **フォーカス**: 色 + アウトライン + 影

### セキュリティ & プライバシー

#### データ保護
- **入力データ**: 暗号化された保存
- **通信**: HTTPS強制、TLS 1.3以上
- **アクセス**: 認証済みユーザーのみ
- **履歴**: 適切なデータ保持期間

#### プライバシー保護
- **個人情報**: 最小限の情報収集
- **履歴データ**: 匿名化された分析
- **AI学習**: 個人を特定できない形での学習
- **データ削除**: ユーザー要求による削除

### 非機能要件

#### パフォーマンス
- **初期表示**: 3秒以内
- **プロフィール取得**: 2秒以内
- **履歴取得**: 5秒以内
- **AI生成依頼**: 1秒以内

#### 可用性
- **稼働率**: 99.9%以上
- **エラー率**: 1%以下
- **復旧時間**: 5分以内

#### スケーラビリティ
- **同時接続**: 10,000ユーザー
- **スループット**: 1,000リクエスト/秒
- **AI生成**: 100件/分

## 3. 曖昧さと解決

### 地域選択
- **都道府県**: プルダウン選択
- **市区町村**: 都道府県選択後の動的更新
- **最寄り駅**: 任意入力

### 好み選択
- **タグ形式**: クリックで選択/解除
- **検索機能**: タグの検索機能
- **カスタムタグ**: 新規タグの追加機能

### AI生成進捗
- **進捗表示**: リアルタイム進捗表示
- **推定時間**: 生成完了までの推定時間
- **キャンセル**: 生成処理のキャンセル機能

## 4. 受け入れ基準例（Gherkin風）

### デートプラン作成
```gherkin
Given ユーザーがデートプラン作成画面にアクセス
When 有効な予算、時間、地域、好みを入力
And 生成ボタンをクリック
Then AI生成依頼が送信される
And 生成中画面に遷移する

Given ユーザーがデートプラン作成画面にアクセス
When 無効な予算（500円）を入力
Then エラーメッセージが表示される
And 生成依頼が阻止される
```

### プロフィール取得
```gherkin
Given ユーザーがデートプラン作成画面にアクセス
When 画面が読み込まれる
Then ユーザープロフィールが取得される
And 2秒以内に表示される

Given ユーザーがデートプラン作成画面にアクセス
When プロフィール取得に失敗
Then エラーメッセージが表示される
And デフォルト値が使用される
```

## 5. リスクとトレードオフ

### AI生成リスク
- **生成失敗**: 適切なエラーハンドリング
- **生成遅延**: タイムアウト設定とリトライ機能
- **品質低下**: フィードバック機能による改善

### UXリスク
- **複雑な入力**: 段階的な入力フォーム
- **生成待機**: 進捗表示とキャンセル機能
- **エラー処理**: 適切なエラーメッセージ

### パフォーマンスリスク
- **AI生成**: 適切なタイムアウト設定
- **ネットワーク**: リトライ機能とエラーハンドリング
- **メモリ使用量**: 効率的なデータ管理

## 6. 拡張余地

### 短期拡張
- **テンプレート**: 事前定義されたプランテンプレート
- **お気に入り**: よく使用する設定の保存
- **共有**: プランの共有機能

### 中期拡張
- **リアルタイム生成**: リアルタイムでのプラン生成
- **協働編集**: パートナーとの協働編集
- **外部連携**: 外部サービスとの連携

### 長期拡張
- **VR対応**: VR環境でのプラン作成
- **AI学習**: ユーザー行動の学習
- **予測機能**: 未来のプラン予測

## 7. 実装ガイドライン

### 技術スタック
- **フロントエンド**: React 18 + TypeScript + Tailwind CSS
- **状態管理**: Zustand
- **フォーム管理**: React Hook Form + Zod
- **HTTP クライアント**: Axios
- **地図**: MapBox API

### コンポーネント設計
```typescript
// メインコンポーネント
interface DatePlanFormProps {
  userId: string;
  coupleId: string;
  onSuccess: (planId: string) => void;
  onError: (error: string) => void;
}

// フォームバリデーション
const datePlanSchema = z.object({
  budget: z.number().min(1000, '1,000円以上で入力してください').max(100000, '100,000円以下で入力してください'),
  duration: z.number().min(1, '1時間以上で入力してください').max(12, '12時間以下で入力してください'),
  location: z.object({
    prefecture: z.string().min(1, '都道府県を選択してください'),
    city: z.string().min(1, '市区町村を選択してください'),
    station: z.string().optional()
  }),
  preferences: z.array(z.string()).max(10, '10個以下で選択してください'),
  specialRequests: z.string().max(500, '500文字以内で入力してください').optional()
});
```

### スタイリング
```css
/* レスポンシブデザイン */
.plan-form-container {
  @apply max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-md;
}

.plan-form {
  @apply space-y-6;
}

.input-group {
  @apply space-y-2;
}

.preference-tags {
  @apply flex flex-wrap gap-2;
}

.preference-tag {
  @apply px-3 py-1 bg-blue-100 text-blue-800 rounded-full cursor-pointer hover:bg-blue-200;
}

.preference-tag.selected {
  @apply bg-blue-500 text-white;
}

/* ダークモード対応 */
@media (prefers-color-scheme: dark) {
  .plan-form-container {
    @apply bg-gray-800;
  }
  .preference-tag {
    @apply bg-blue-900 text-blue-200 hover:bg-blue-800;
  }
  .preference-tag.selected {
    @apply bg-blue-600 text-white;
  }
}
```

## 8. 日本語サンプルデータ

### デートプラン要求データ
```json
{
  "datePlanRequests": [
    {
      "planId": "plan_001",
      "userId": "usr_001",
      "coupleId": "cp_001",
      "budget": 15000,
      "duration": 4,
      "location": {
        "prefecture": "東京都",
        "city": "渋谷区",
        "station": "渋谷駅"
      },
      "preferences": ["映画", "レストラン", "カフェ", "散歩"],
      "specialRequests": "記念日なので特別な場所でお祝いしたい",
      "status": "generating",
      "createdAt": "2025-01-27T10:00:00Z"
    },
    {
      "planId": "plan_002",
      "userId": "usr_002",
      "coupleId": "cp_002",
      "budget": 8000,
      "duration": 3,
      "location": {
        "prefecture": "大阪府",
        "city": "大阪市",
        "station": "梅田駅"
      },
      "preferences": ["美術館", "レストラン", "カフェ"],
      "specialRequests": "アートに興味があるので美術館を中心に",
      "status": "completed",
      "createdAt": "2025-01-27T10:00:00Z"
    },
    {
      "planId": "plan_003",
      "userId": "usr_003",
      "coupleId": "cp_003",
      "budget": 5000,
      "duration": 2,
      "location": {
        "prefecture": "神奈川県",
        "city": "横浜市",
        "station": "みなとみらい駅"
      },
      "preferences": ["公園", "散歩", "カフェ"],
      "specialRequests": "のんびりとした時間を過ごしたい",
      "status": "generating",
      "createdAt": "2025-01-27T10:00:00Z"
    },
    {
      "planId": "plan_004",
      "userId": "usr_004",
      "coupleId": "cp_004",
      "budget": 25000,
      "duration": 6,
      "location": {
        "prefecture": "京都府",
        "city": "京都市",
        "station": "京都駅"
      },
      "preferences": ["観光", "レストラン", "お寺", "神社"],
      "specialRequests": "京都の伝統的な場所を巡りたい",
      "status": "completed",
      "createdAt": "2025-01-27T10:00:00Z"
    },
    {
      "planId": "plan_005",
      "userId": "usr_005",
      "coupleId": "cp_005",
      "budget": 12000,
      "duration": 5,
      "location": {
        "prefecture": "愛知県",
        "city": "名古屋市",
        "station": "名古屋駅"
      },
      "preferences": ["ショッピング", "レストラン", "カフェ", "映画"],
      "specialRequests": "名古屋の名物を食べたい",
      "status": "generating",
      "createdAt": "2025-01-27T10:00:00Z"
    }
  ]
}
```

### 地域データ
```json
{
  "prefectures": [
    "北海道", "青森県", "岩手県", "宮城県", "秋田県", "山形県", "福島県",
    "茨城県", "栃木県", "群馬県", "埼玉県", "千葉県", "東京都", "神奈川県",
    "新潟県", "富山県", "石川県", "福井県", "山梨県", "長野県", "岐阜県",
    "静岡県", "愛知県", "三重県", "滋賀県", "京都府", "大阪府", "兵庫県",
    "奈良県", "和歌山県", "鳥取県", "島根県", "岡山県", "広島県", "山口県",
    "徳島県", "香川県", "愛媛県", "高知県", "福岡県", "佐賀県", "長崎県",
    "熊本県", "大分県", "宮崎県", "鹿児島県", "沖縄県"
  ],
  "cities": {
    "東京都": [
      "千代田区", "中央区", "港区", "新宿区", "文京区", "台東区", "墨田区",
      "江東区", "品川区", "目黒区", "大田区", "世田谷区", "渋谷区", "中野区",
      "杉並区", "豊島区", "北区", "荒川区", "板橋区", "練馬区", "足立区",
      "葛飾区", "江戸川区", "八王子市", "立川市", "武蔵野市", "三鷹市",
      "青梅市", "府中市", "昭島市", "調布市", "町田市", "小金井市", "小平市",
      "日野市", "東村山市", "国分寺市", "国立市", "福生市", "狛江市", "東大和市",
      "清瀬市", "東久留米市", "武蔵村山市", "多摩市", "稲城市", "羽村市",
      "あきる野市", "西東京市"
    ],
    "大阪府": [
      "大阪市", "堺市", "岸和田市", "豊中市", "池田市", "吹田市", "泉大津市",
      "高槻市", "貝塚市", "守口市", "枚方市", "茨木市", "八尾市", "泉佐野市",
      "富田林市", "寝屋川市", "河内長野市", "松原市", "大東市", "和泉市",
      "箕面市", "柏原市", "羽曳野市", "門真市", "摂津市", "高石市", "藤井寺市",
      "東大阪市", "泉南市", "四條畷市", "交野市", "大阪狭山市", "阪南市"
    ],
    "神奈川県": [
      "横浜市", "川崎市", "相模原市", "横須賀市", "平塚市", "鎌倉市", "藤沢市",
      "小田原市", "茅ヶ崎市", "逗子市", "三浦市", "秦野市", "厚木市", "大和市",
      "伊勢原市", "海老名市", "座間市", "南足柄市", "綾瀬市", "葉山町", "寒川町",
      "大磯町", "二宮町", "中井町", "大井町", "松田町", "山北町", "開成町",
      "箱根町", "真鶴町", "湯河原町", "愛川町", "清川村"
    ]
  }
}
```

### 好みタグデータ
```json
{
  "preferenceTags": [
    "映画", "レストラン", "カフェ", "散歩", "美術館", "公園", "ショッピング",
    "観光", "お寺", "神社", "温泉", "海", "山", "川", "湖", "滝", "花火",
    "祭り", "イベント", "ライブ", "コンサート", "演劇", "ミュージカル",
    "オペラ", "バレエ", "ダンス", "社交ダンス", "フラメンコ", "サルサ",
    "タンゴ", "ワルツ", "フォックストロット", "カラオケ", "ボウリング",
    "ダーツ", "ビリヤード", "ゴルフ", "テニス", "バドミントン", "バスケットボール",
    "サッカー", "野球", "スイミング", "サイクリング", "ランニング", "ウォーキング",
    "筋トレ", "ヨガ", "ピラティス", "エアロビクス", "ズンバ", "ボクササイズ",
    "キックボクシング", "空手", "柔道", "剣道", "弓道", "合気道", "太極拳",
    "気功", "瞑想", "座禅", "写経", "仏像巡り", "神社巡り", "お寺巡り",
    "パワースポット巡り", "聖地巡礼", "世界遺産巡り", "城巡り", "庭園巡り",
    "博物館巡り", "科学館巡り", "水族館巡り", "動物園巡り", "植物園巡り",
    "花見", "紅葉狩り", "雪見", "花火大会", "祭り", "イベント", "フェスティバル",
    "マーケット", "フリーマーケット", "蚤の市", "骨董市", "手作り市",
    "農産物直売所", "道の駅", "サービスエリア", "パーキングエリア",
    "展望台", "スカイツリー", "東京タワー", "六本木ヒルズ", "渋谷スカイ",
    "新宿都庁", "横浜ランドマークタワー", "名古屋テレビ塔", "通天閣",
    "天保山ハーバービレッジ", "USJ", "ディズニーランド", "ディズニーシー",
    "富士急ハイランド", "ナガシマスパーランド", "ひらかたパーク", "としまえん",
    "後楽園ゆうえんち", "よみうりランド", "西武園ゆうえんち", "東武動物公園",
    "多摩動物公園", "上野動物園", "サンシャイン水族館", "すみだ水族館",
    "アクアパーク品川", "マクセルアクアパーク", "新江ノ島水族館", "名古屋港水族館",
    "海遊館", "アドベンチャーワールド", "ユニバーサル・スタジオ・ジャパン"
  ]
}
```

### デート履歴データ
```json
{
  "dateHistory": [
    {
      "dateId": "date_001",
      "coupleId": "cp_001",
      "date": "2025-01-20",
      "location": "渋谷",
      "activities": ["映画", "レストラン", "カフェ"],
      "budget": 12000,
      "duration": 4,
      "rating": 5,
      "notes": "とても楽しかった"
    },
    {
      "dateId": "date_002",
      "coupleId": "cp_001",
      "date": "2025-01-13",
      "location": "新宿",
      "activities": ["ショッピング", "レストラン"],
      "budget": 8000,
      "duration": 3,
      "rating": 4,
      "notes": "良い時間を過ごせた"
    },
    {
      "dateId": "date_003",
      "coupleId": "cp_002",
      "date": "2025-01-19",
      "location": "大阪",
      "activities": ["美術館", "レストラン", "カフェ"],
      "budget": 10000,
      "duration": 5,
      "rating": 5,
      "notes": "アートを楽しめた"
    },
    {
      "dateId": "date_004",
      "coupleId": "cp_003",
      "date": "2025-01-18",
      "location": "横浜",
      "activities": ["公園", "散歩", "カフェ"],
      "budget": 3000,
      "duration": 2,
      "rating": 4,
      "notes": "のんびりできた"
    },
    {
      "dateId": "date_005",
      "coupleId": "cp_004",
      "date": "2025-01-17",
      "location": "京都",
      "activities": ["観光", "レストラン", "お寺"],
      "budget": 20000,
      "duration": 6,
      "rating": 5,
      "notes": "京都の文化を楽しめた"
    }
  ]
}
```

### エラーメッセージ
```json
{
  "errorMessages": {
    "budget": {
      "required": "予算を入力してください",
      "tooLow": "1,000円以上で入力してください",
      "tooHigh": "100,000円以下で入力してください",
      "invalid": "正しい金額を入力してください"
    },
    "duration": {
      "required": "時間を入力してください",
      "tooShort": "1時間以上で入力してください",
      "tooLong": "12時間以下で入力してください",
      "invalid": "正しい時間を入力してください"
    },
    "location": {
      "prefectureRequired": "都道府県を選択してください",
      "cityRequired": "市区町村を選択してください",
      "invalid": "有効な地域を選択してください"
    },
    "preferences": {
      "tooMany": "10個以下で選択してください",
      "invalid": "無効な好みが含まれています"
    },
    "specialRequests": {
      "tooLong": "500文字以内で入力してください",
      "invalid": "使用できない文字が含まれています"
    },
    "general": {
      "networkError": "ネットワークエラーが発生しました",
      "serverError": "サーバーエラーが発生しました",
      "timeout": "タイムアウトが発生しました",
      "unknown": "不明なエラーが発生しました"
    }
  }
}
```

### 成功メッセージ
```json
{
  "successMessages": {
    "planRequestSent": "デートプラン生成依頼が送信されました",
    "profileLoaded": "プロフィール情報が読み込まれました",
    "historyLoaded": "デート履歴が読み込まれました",
    "formSaved": "入力内容が保存されました"
  }
}
```

## 9. 最終チェックリスト

### 機能要件
- [ ] デートプラン作成機能が正常に動作する
- [ ] ユーザープロフィール取得機能が正常に動作する
- [ ] デート履歴取得機能が正常に動作する
- [ ] AI生成依頼機能が正常に動作する
- [ ] フォームバリデーションが適切に機能する

### 非機能要件
- [ ] レスポンシブデザインが実装されている
- [ ] アクセシビリティ（WCAG 2.1 AA）に準拠している
- [ ] パフォーマンス要件を満たしている
- [ ] セキュリティ要件が実装されている
- [ ] エラー率が許容範囲内である

### ユーザビリティ
- [ ] 直感的なUI/UXが実装されている
- [ ] 適切なフィードバックが提供されている
- [ ] 入力フォームが分かりやすい
- [ ] エラーメッセージが分かりやすい
- [ ] キーボード操作が可能である

### セキュリティ
- [ ] 入力データが適切に保護されている
- [ ] HTTPS通信が強制されている
- [ ] 認証・認可が適切に実装されている
- [ ] プライバシー保護が実装されている
- [ ] データ削除機能が実装されている

### 技術要件
- [ ] AI生成依頼が適切に実装されている
- [ ] プロフィール取得が適切に実装されている
- [ ] 履歴取得が適切に実装されている
- [ ] エラーハンドリングが適切に実装されている
- [ ] タイムアウト処理が適切に実装されている

---

**作成日**: 2025年1月27日  
**バージョン**: 1.0  
**作成者**: ソフトウェアエンジニア・UX/UIデザイナー  
**承認者**: [承認者名]  
**レビュー者**: [レビュー者名]
