# UC003-001: ポータルトップ画面 実装指示書

## 1. 全体評価

### 目的とゴール
- **主要目的**: デート情報の統合表示とアプリ誘導機能を提供
- **ビジネスゴール**: ユーザー獲得とエンゲージメント向上
- **技術ゴール**: 高品質なコンテンツ配信とSEO最適化の実現

### 受け入れ基準
- 記事一覧が3秒以内に表示される
- 人気スポットが2秒以内に表示される
- 検索実行が1秒以内に完了する
- モバイル・デスクトップ両対応のレスポンシブデザイン
- WCAG 2.1 AA準拠のアクセシビリティ

### 機能段階性
1. **基礎**: 記事一覧、人気スポット、検索機能
2. **拡張**: カテゴリ別表示、フィルタ機能、お気に入り機能
3. **制約**: 表示制限、検索制限、外部リンク制限

## 2. 仕様の厳密化

### コア機能

#### 記事一覧取得
- **取得**: 最新記事の一覧取得
- **表示**: 記事一覧の表示
- **更新**: 記事情報の更新
- **完了**: 取得完了の通知

#### 人気スポット取得
- **取得**: 人気スポットの一覧取得
- **表示**: 人気スポットの表示
- **更新**: スポット情報の更新
- **完了**: 取得完了の通知

#### 検索実行
- **入力**: 検索クエリの入力
- **実行**: 検索の実行
- **表示**: 検索結果の表示
- **完了**: 検索完了の通知

#### アプリ誘導
- **表示**: アプリダウンロード誘導
- **クリック**: ダウンロードリンク
- **完了**: 誘導完了の通知

#### レスポンシブ表示
- **適応**: 画面サイズに応じた表示
- **最適化**: モバイル・デスクトップ最適化
- **完了**: 適応完了の通知

### 入力制約 & バリデーション

#### 検索クエリ
- **長さ**: 1-100文字
- **形式**: 文字列
- **必須**: 任意項目
- **エラーメッセージ**: "100文字以内で入力してください"

#### ページ番号
- **範囲**: 1-1000
- **形式**: 数値のみ
- **必須**: 必須項目
- **エラーメッセージ**: "1-1000の範囲で入力してください"

#### カテゴリ
- **選択肢**: 事前定義されたカテゴリ
- **必須**: 任意項目
- **エラーメッセージ**: "有効なカテゴリを選択してください"

### データモデル & API

#### リクエストモデル
```typescript
interface ArticleListRequest {
  page: number;
  limit: number;
  category?: string;
  sortBy?: 'date' | 'popularity' | 'rating';
}

interface TrendingSpotsRequest {
  limit: number;
  category?: string;
  location?: string;
}

interface SearchRequest {
  query: string;
  page: number;
  limit: number;
  filters?: SearchFilters;
}

interface SearchFilters {
  category?: string;
  location?: string;
  priceRange?: string;
  rating?: number;
}
```

#### レスポンスモデル
```typescript
interface ArticleListResponse {
  articles: Article[];
  totalCount: number;
  currentPage: number;
  totalPages: number;
  hasMore: boolean;
}

interface Article {
  articleId: string;
  title: string;
  summary: string;
  content: string;
  category: string;
  tags: string[];
  author: string;
  publishedAt: string;
  updatedAt: string;
  viewCount: number;
  likeCount: number;
  rating: number;
  imageUrl?: string;
  readTime: number; // minutes
}

interface TrendingSpotsResponse {
  spots: TrendingSpot[];
  totalCount: number;
  updatedAt: string;
}

interface TrendingSpot {
  spotId: string;
  name: string;
  description: string;
  category: string;
  location: string;
  rating: number;
  priceLevel: number;
  imageUrl?: string;
  tags: string[];
  viewCount: number;
  likeCount: number;
}

interface SearchResponse {
  results: SearchResult[];
  totalCount: number;
  currentPage: number;
  totalPages: number;
  hasMore: boolean;
  searchTime: number; // milliseconds
}

interface SearchResult {
  id: string;
  type: 'article' | 'spot' | 'event';
  title: string;
  description: string;
  category: string;
  rating?: number;
  imageUrl?: string;
  relevanceScore: number;
}
```

#### API エンドポイント
- **記事一覧取得**: `GET /api/v1/portal/articles`
- **人気スポット取得**: `GET /api/v1/portal/trending`
- **コンテンツ検索**: `GET /api/v1/portal/search`

### UX / A11y

#### キーボード操作
- **Tab順序**: 検索ボックス → 記事一覧 → 人気スポット → アプリ誘導
- **Enter**: 検索実行
- **Escape**: 検索クリア
- **矢印キー**: 記事間の移動

#### スクリーンリーダー対応
- **aria-label**: 各記事の説明
- **aria-live**: 検索結果の読み上げ
- **aria-describedby**: 記事説明の関連付け
- **role**: 記事要素の役割定義

#### 色覚対応
- **記事表示**: 色 + アイコン + テキスト
- **検索結果**: 色 + ハイライト + テキスト
- **フォーカス**: 色 + アウトライン + 影

### セキュリティ & プライバシー

#### データ保護
- **記事データ**: 暗号化された保存
- **通信**: HTTPS強制、TLS 1.3以上
- **アクセス**: 認証不要（公開コンテンツ）
- **キャッシュ**: 適切なキャッシュ戦略

#### プライバシー保護
- **個人情報**: 最小限の情報収集
- **閲覧履歴**: 匿名化された分析
- **検索履歴**: 適切なデータ保護
- **データ削除**: ユーザー要求による削除

### 非機能要件

#### パフォーマンス
- **記事一覧取得**: 3秒以内
- **人気スポット取得**: 2秒以内
- **検索実行**: 1秒以内
- **ページ表示**: 2秒以内

#### 可用性
- **稼働率**: 99.9%以上
- **エラー率**: 1%以下
- **復旧時間**: 5分以内

#### スケーラビリティ
- **同時接続**: 100,000ユーザー
- **スループット**: 10,000リクエスト/秒
- **記事表示**: 1,000件/秒

## 3. 曖昧さと解決

### 記事表示
- **一覧表示**: 10-20件の記事を一覧表示
- **詳細表示**: クリックで詳細表示
- **無限スクロール**: スクロールで追加読み込み

### 検索機能
- **リアルタイム検索**: 入力に応じた検索
- **検索結果**: 関連度順での表示
- **フィルタ**: カテゴリ・地域・価格での絞り込み

### アプリ誘導
- **表示**: 適切なタイミングでの表示
- **クリック**: ダウンロードリンク
- **完了**: 誘導完了の通知

## 4. 受け入れ基準例（Gherkin風）

### 記事一覧表示
```gherkin
Given ユーザーがポータルトップ画面にアクセス
When 記事一覧が取得される
Then 記事一覧が表示される
And 3秒以内に表示される

Given ユーザーがポータルトップ画面にアクセス
When 記事一覧の取得に失敗
Then エラーメッセージが表示される
And 再試行ボタンが表示される
```

### 検索実行
```gherkin
Given ユーザーがポータルトップ画面にアクセス
When 検索クエリを入力
And 検索ボタンをクリック
Then 検索結果が表示される
And 1秒以内に完了する

Given ユーザーがポータルトップ画面にアクセス
When 無効な検索クエリを入力
Then エラーメッセージが表示される
And 検索が阻止される
```

## 5. リスクとトレードオフ

### 技術リスク
- **記事取得失敗**: 適切なエラーハンドリング
- **検索遅延**: 適切なタイムアウト設定
- **大量データ**: 適切なページネーション

### UXリスク
- **複雑な表示**: 分かりやすい記事表示
- **検索結果**: 関連度の高い結果表示
- **アプリ誘導**: 適切なタイミングでの誘導

### パフォーマンスリスク
- **大量記事**: 適切なページネーション
- **画像表示**: 適切な画像最適化
- **ネットワーク**: 適切なキャッシュ戦略

## 6. 拡張余地

### 短期拡張
- **カテゴリ別表示**: カテゴリ別の記事表示
- **フィルタ機能**: 詳細なフィルタ機能
- **お気に入り機能**: 記事のお気に入り機能

### 中期拡張
- **パーソナライズ**: ユーザーに応じた記事推薦
- **ソーシャル機能**: 記事の共有・コメント機能
- **分析**: 閲覧パターンの分析

### 長期拡張
- **AI推薦**: AIによる記事推薦
- **動画コンテンツ**: 動画記事の対応
- **VR対応**: VR環境での記事表示

## 7. 実装ガイドライン

### 技術スタック
- **フロントエンド**: React 18 + TypeScript + Tailwind CSS
- **状態管理**: Zustand
- **HTTP クライアント**: Axios
- **検索**: Elasticsearch
- **画像最適化**: Next.js Image

### コンポーネント設計
```typescript
// メインコンポーネント
interface PortalTopProps {
  onArticleClick: (articleId: string) => void;
  onSpotClick: (spotId: string) => void;
  onAppDownload: () => void;
  onError: (error: string) => void;
}

// 記事一覧
interface ArticleListProps {
  articles: Article[];
  onLoadMore: () => void;
  hasMore: boolean;
  loading: boolean;
}

// 検索機能
interface SearchComponentProps {
  onSearch: (query: string, filters: SearchFilters) => void;
  onClear: () => void;
  loading: boolean;
}
```

### スタイリング
```css
/* レスポンシブデザイン */
.portal-container {
  @apply max-w-7xl mx-auto px-4 sm:px-6 lg:px-8;
}

.portal-header {
  @apply text-center py-12;
}

.portal-title {
  @apply text-4xl font-bold text-gray-900 mb-4;
}

.portal-subtitle {
  @apply text-xl text-gray-600 mb-8;
}

.search-section {
  @apply mb-12;
}

.search-container {
  @apply max-w-2xl mx-auto;
}

.search-input {
  @apply w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none;
}

.search-button {
  @apply ml-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none;
}

.articles-section {
  @apply mb-12;
}

.articles-grid {
  @apply grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6;
}

.article-card {
  @apply bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow;
}

.article-image {
  @apply w-full h-48 object-cover;
}

.article-content {
  @apply p-6;
}

.article-title {
  @apply text-xl font-semibold text-gray-900 mb-2;
}

.article-summary {
  @apply text-gray-600 mb-4;
}

.article-meta {
  @apply flex items-center justify-between text-sm text-gray-500;
}

.article-author {
  @apply font-medium;
}

.article-date {
  @apply text-gray-500;
}

.trending-section {
  @apply mb-12;
}

.trending-title {
  @apply text-2xl font-bold text-gray-900 mb-6;
}

.trending-grid {
  @apply grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4;
}

.trending-spot {
  @apply bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow;
}

.spot-image {
  @apply w-full h-32 object-cover;
}

.spot-content {
  @apply p-4;
}

.spot-name {
  @apply text-lg font-semibold text-gray-900 mb-1;
}

.spot-description {
  @apply text-sm text-gray-600 mb-2;
}

.spot-rating {
  @apply flex items-center text-sm text-yellow-600;
}

.app-cta-section {
  @apply bg-blue-600 text-white py-12 rounded-lg text-center;
}

.app-cta-title {
  @apply text-2xl font-bold mb-4;
}

.app-cta-description {
  @apply text-lg mb-6;
}

.app-download-button {
  @apply inline-block px-8 py-3 bg-white text-blue-600 rounded-lg font-semibold hover:bg-gray-100 transition-colors;
}

/* ダークモード対応 */
@media (prefers-color-scheme: dark) {
  .portal-container {
    @apply bg-gray-900;
  }
  .portal-title {
    @apply text-gray-100;
  }
  .portal-subtitle {
    @apply text-gray-400;
  }
  .search-input {
    @apply border-gray-600 bg-gray-800 text-white;
  }
  .article-card {
    @apply bg-gray-800;
  }
  .article-title {
    @apply text-gray-100;
  }
  .article-summary {
    @apply text-gray-400;
  }
  .article-meta {
    @apply text-gray-500;
  }
  .trending-title {
    @apply text-gray-100;
  }
  .trending-spot {
    @apply bg-gray-800;
  }
  .spot-name {
    @apply text-gray-100;
  }
  .spot-description {
    @apply text-gray-400;
  }
}
```

## 8. 日本語サンプルデータ

### 記事データ
```json
{
  "articles": [
    {
      "articleId": "article_001",
      "title": "渋谷で過ごすロマンチックなデートスポット10選",
      "summary": "渋谷の街で楽しめるロマンチックなデートスポットを厳選してご紹介します。",
      "content": "渋谷は東京の中心地として、多くのカップルに愛されるデートスポットがたくさんあります。今回は、特にロマンチックな雰囲気を楽しめるスポットを10選ご紹介します。",
      "category": "デートスポット",
      "tags": ["渋谷", "ロマンチック", "デート", "カフェ", "レストラン"],
      "author": "デートプランナー",
      "publishedAt": "2025-01-27T10:00:00Z",
      "updatedAt": "2025-01-27T10:00:00Z",
      "viewCount": 1250,
      "likeCount": 89,
      "rating": 4.5,
      "imageUrl": "https://example.com/images/shibuya-date-spots.jpg",
      "readTime": 8
    },
    {
      "articleId": "article_002",
      "title": "新宿で楽しむアクティブデートプラン",
      "summary": "新宿で体を動かしながら楽しめるアクティブなデートプランをご提案します。",
      "content": "新宿には、体を動かしながら楽しめるアクティビティがたくさんあります。今回は、カップルで楽しめるアクティブなデートプランをご紹介します。",
      "category": "アクティビティ",
      "tags": ["新宿", "アクティブ", "デート", "スポーツ", "エンターテイメント"],
      "author": "アクティビティガイド",
      "publishedAt": "2025-01-26T15:30:00Z",
      "updatedAt": "2025-01-26T15:30:00Z",
      "viewCount": 980,
      "likeCount": 67,
      "rating": 4.3,
      "imageUrl": "https://example.com/images/shinjuku-active-date.jpg",
      "readTime": 6
    },
    {
      "articleId": "article_003",
      "title": "上野で過ごす文化的デートのすすめ",
      "summary": "上野の美術館と公園で過ごす文化的で落ち着いたデートプランをご紹介します。",
      "content": "上野は、美術館や博物館が集まる文化的なエリアです。今回は、アートを楽しみながら過ごす文化的なデートプランをご提案します。",
      "category": "文化",
      "tags": ["上野", "文化的", "デート", "美術館", "公園"],
      "author": "文化ガイド",
      "publishedAt": "2025-01-25T09:15:00Z",
      "updatedAt": "2025-01-25T09:15:00Z",
      "viewCount": 756,
      "likeCount": 45,
      "rating": 4.1,
      "imageUrl": "https://example.com/images/ueno-cultural-date.jpg",
      "readTime": 5
    }
  ]
}
```

### 人気スポットデータ
```json
{
  "trendingSpots": [
    {
      "spotId": "spot_001",
      "name": "渋谷スカイ",
      "description": "渋谷の新ランドマーク。地上229mの展望台から東京の街を一望できます。",
      "category": "観光",
      "location": "渋谷区",
      "rating": 4.5,
      "priceLevel": 2,
      "imageUrl": "https://example.com/images/shibuya-sky.jpg",
      "tags": ["展望台", "夜景", "記念写真", "ロマンチック"],
      "viewCount": 5000,
      "likeCount": 320
    },
    {
      "spotId": "spot_002",
      "name": "カフェ・ド・パリ",
      "description": "渋谷の人気カフェ。フレンチスタイルの料理とコーヒーが自慢です。",
      "category": "カフェ",
      "location": "渋谷区",
      "rating": 4.2,
      "priceLevel": 3,
      "imageUrl": "https://example.com/images/cafe-de-paris.jpg",
      "tags": ["カフェ", "フレンチ", "コーヒー", "ランチ"],
      "viewCount": 3200,
      "likeCount": 180
    },
    {
      "spotId": "spot_003",
      "name": "上野の森美術館",
      "description": "上野公園内にある美術館。現代アートを中心とした展示を行っています。",
      "category": "美術館",
      "location": "台東区",
      "rating": 4.0,
      "priceLevel": 2,
      "imageUrl": "https://example.com/images/ueno-mori-museum.jpg",
      "tags": ["美術館", "現代アート", "上野公園", "文化"],
      "viewCount": 2800,
      "likeCount": 150
    },
    {
      "spotId": "spot_004",
      "name": "新宿ピカデリー",
      "description": "新宿の人気映画館。最新の映画を大画面で楽しめます。",
      "category": "映画館",
      "location": "新宿区",
      "rating": 4.3,
      "priceLevel": 3,
      "imageUrl": "https://example.com/images/shinjuku-piccadilly.jpg",
      "tags": ["映画館", "最新映画", "大画面", "エンターテイメント"],
      "viewCount": 4100,
      "likeCount": 250
    }
  ]
}
```

### 検索結果データ
```json
{
  "searchResults": [
    {
      "id": "article_001",
      "type": "article",
      "title": "渋谷で過ごすロマンチックなデートスポット10選",
      "description": "渋谷の街で楽しめるロマンチックなデートスポットを厳選してご紹介します。",
      "category": "デートスポット",
      "rating": 4.5,
      "imageUrl": "https://example.com/images/shibuya-date-spots.jpg",
      "relevanceScore": 0.95
    },
    {
      "id": "spot_001",
      "type": "spot",
      "title": "渋谷スカイ",
      "description": "渋谷の新ランドマーク。地上229mの展望台から東京の街を一望できます。",
      "category": "観光",
      "rating": 4.5,
      "imageUrl": "https://example.com/images/shibuya-sky.jpg",
      "relevanceScore": 0.92
    },
    {
      "id": "article_002",
      "type": "article",
      "title": "新宿で楽しむアクティブデートプラン",
      "description": "新宿で体を動かしながら楽しめるアクティブなデートプランをご提案します。",
      "category": "アクティビティ",
      "rating": 4.3,
      "imageUrl": "https://example.com/images/shinjuku-active-date.jpg",
      "relevanceScore": 0.88
    }
  ]
}
```

### エラーメッセージ
```json
{
  "errorMessages": {
    "articleList": {
      "networkError": "記事一覧の取得に失敗しました",
      "serverError": "サーバーエラーが発生しました",
      "timeout": "記事一覧の取得がタイムアウトしました",
      "notFound": "記事が見つかりません"
    },
    "trendingSpots": {
      "networkError": "人気スポットの取得に失敗しました",
      "serverError": "サーバーエラーが発生しました",
      "timeout": "人気スポットの取得がタイムアウトしました",
      "notFound": "人気スポットが見つかりません"
    },
    "search": {
      "queryRequired": "検索クエリを入力してください",
      "queryTooLong": "100文字以内で入力してください",
      "networkError": "検索に失敗しました",
      "serverError": "サーバーエラーが発生しました",
      "timeout": "検索がタイムアウトしました",
      "noResults": "検索結果が見つかりません"
    },
    "general": {
      "networkError": "ネットワークエラーが発生しました",
      "serverError": "サーバーエラーが発生しました",
      "timeout": "タイムアウトが発生しました",
      "unknown": "不明なエラーが発生しました"
    }
  }
}
```

### 成功メッセージ
```json
{
  "successMessages": {
    "articlesLoaded": "記事一覧が読み込まれました",
    "trendingSpotsLoaded": "人気スポットが読み込まれました",
    "searchCompleted": "検索が完了しました",
    "appDownloadInitiated": "アプリダウンロードを開始しました"
  }
}
```

## 9. 最終チェックリスト

### 機能要件
- [ ] 記事一覧取得機能が正常に動作する
- [ ] 人気スポット取得機能が正常に動作する
- [ ] 検索実行機能が正常に動作する
- [ ] アプリ誘導機能が正常に動作する
- [ ] レスポンシブ表示機能が正常に動作する

### 非機能要件
- [ ] レスポンシブデザインが実装されている
- [ ] アクセシビリティ（WCAG 2.1 AA）に準拠している
- [ ] パフォーマンス要件を満たしている
- [ ] セキュリティ要件が実装されている
- [ ] エラー率が許容範囲内である

### ユーザビリティ
- [ ] 直感的なUI/UXが実装されている
- [ ] 適切なフィードバックが提供されている
- [ ] 記事表示が分かりやすい
- [ ] エラーメッセージが分かりやすい
- [ ] キーボード操作が可能である

### セキュリティ
- [ ] 記事データが適切に保護されている
- [ ] HTTPS通信が強制されている
- [ ] 適切なキャッシュ戦略が実装されている
- [ ] プライバシー保護が実装されている
- [ ] データ削除機能が実装されている

### 技術要件
- [ ] 記事一覧取得が適切に実装されている
- [ ] 人気スポット取得が適切に実装されている
- [ ] 検索機能が適切に実装されている
- [ ] エラーハンドリングが適切に実装されている
- [ ] 状態管理が適切に実装されている

---

**作成日**: 2025年1月27日  
**バージョン**: 1.0  
**作成者**: ソフトウェアエンジニア・UX/UIデザイナー  
**承認者**: [承認者名]  
**レビュー者**: [レビュー者名]
