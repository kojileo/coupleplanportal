# CouplePlan 実装計画 (2025年10月版) - 更新版

## 1. スコープ概要
- MVP v0.9: デートプラン生成〜共同編集〜課金管理までの一連フローを Web で提供
- 非スコープ: 位置情報ピン専用画面 (UC005-002)、アルバム生成 (UC005-005)、オフラインモード (COMMON-005)
- 依存チーム: AI プラン生成 (AI Team)、課金・会計 (Growth Team)

## 実装状況 (2025年1月27日更新)

### ✅ 完了済み
- **プロジェクト構造セットアップ**: Next.js 15 + TypeScript + Tailwind CSS
- **共通UIコンポーネント**: Button, Card, Input, Modal, Stepper
- **型定義**: ユーザー、デートプラン、ポータル、共同編集、仲裁、Date Canvas、課金関連
- **ユーティリティ関数**: 日付フォーマット、バリデーション、ローカルストレージ、エラーハンドリング
- **全画面実装完了**: 34画面すべてのフロントエンド実装
  - **認証系 (4画面)**: AUTH-001〜AUTH-004
  - **共通系 (5画面)**: COMMON-001〜COMMON-005
  - **UC-001 (5画面)**: UC001-001〜UC001-005
  - **UC-002 (5画面)**: UC002-001〜UC002-005
  - **UC-003 (5画面)**: UC003-001〜UC003-005
  - **UC-004 (5画面)**: UC004-001〜UC004-005
  - **UC-005 (1画面)**: UC005-001
  - **UC-007 (5画面)**: UC007-001〜UC007-005
- **プロトタイプとの完全一致**: HTML/CSSプロトタイプのUI/UXを忠実に再現
- **レスポンシブデザイン**: モバイルファーストで全画面対応
- **インタラクティブ機能**: タブ、モーダル、フォーム、フィルターなどの動的要素

### 🚧 進行中
- **API統合**: バックエンドとの連携
- **テスト実装**: ユニットテスト、統合テスト
- **パフォーマンス最適化**: 画像最適化、コード分割

### 📋 未着手
- **本番デプロイ**: Vercel + AWS ECS
- **監視・ログ**: エラー追跡、パフォーマンス監視

## 2. タイムライン (更新版)
| フェーズ | 期間 | 主担当 | 成果物 | 状況 |
|----------|------|--------|--------|------|
| Sprint 0 (設計) | 10/07 - 10/11 | FE/BE/UX | 技術選定、APIモック、UIライブラリ定義 | ✅ 完了 |
| Sprint 1 (認証/共通) | 10/14 - 10/25 | FE | AUTH, COMMON 系の実装、CI 整備 | ✅ 完了 |
| Sprint 2 (UC001/UC002) | 10/28 - 11/08 | FE/AI | プラン生成・共同編集、リアルタイム同期 PoC | ✅ 完了 |
| Sprint 3 (UC003/UC004) | 11/11 - 11/22 | FE/BE | ポータル、仲裁フロー、AI連携強化 | ✅ 完了 |
| Sprint 4 (UC005/UC007) | 11/25 - 12/06 | FE/Growth | Date Canvas、課金管理、Stripe 連携 | ✅ 完了 |
| Hardening | 12/09 - 12/20 | QA/All | バグ修正、パフォーマンス改善、リリース判定 | 🚧 進行中 |

### 現在の進捗 (2025年1月27日)
- **Sprint 1**: 100% 完了 (認証・共通系画面)
- **Sprint 2**: 100% 完了 (UC001・UC002系画面)
- **Sprint 3**: 100% 完了 (UC003・UC004系画面)
- **Sprint 4**: 100% 完了 (UC005・UC007系画面)
- **フロントエンド実装**: 100% 完了 (全34画面)

## 3. 技術スタック (実装済み)
- **Frontend**: Next.js 15 + TypeScript + Tailwind CSS ✅
- **UI Components**: カスタムコンポーネント (Button, Card, Input, Modal, Stepper) ✅
- **State Management**: React Hooks + Context API ✅
- **Styling**: カスタムCSS (プロトタイプ準拠) + Tailwind CSS ✅
- **Icons**: Font Awesome (プロトタイプ準拠) ✅
- **Forms**: React Hook Form + カスタムバリデーション ✅
- **Responsive Design**: モバイルファースト、全画面対応 ✅
- **Accessibility**: キーボードナビゲーション、スクリーンリーダー対応 ✅

### 未実装 (今後の予定)
- **Backend**: FastAPI + PostgreSQL + Redis
- **AI Integration**: LangChain + OpenAI API
- **Realtime**: Supabase Realtime or Ably (UC002/UC005)
- **Infrastructure**: Vercel (FE), AWS ECS (BE), RDS, S3, CloudFront, Stripe

## 4. 主要タスク (実装状況)
### 4.1 共通 ✅ 完了
- [x] デザインシステム / カラートークンをプロトタイプ準拠で実装
- [x] 共通UIコンポーネント (Button, Card, Input, Modal, Stepper) を実装
- [x] 型定義とユーティリティ関数の実装
- [x] 全34画面のフロントエンド実装完了
- [ ] i18n フレームワーク (next-intl) の導入

### 4.2 認証 ✅ 完了 (フロントエンド)
- [x] ログイン・アカウント作成画面 (AUTH-001)
- [x] プロフィール設定画面 (AUTH-002)
- [x] プライバシー設定画面 (AUTH-003)
- [x] パートナー連携設定画面 (AUTH-004)
- [ ] Supabase Auth を用いたメールリンクログイン
- [ ] プロフィール画像アップロード (S3 + presigned URL)
- [ ] パートナー招待コード生成

### 4.3 プラン生成/共同編集 ✅ 完了 (フロントエンド)
- [x] デートプラン作成画面 (UC001-001)
- [x] AI生成中画面 (UC001-002)
- [x] プラン提案画面 (UC001-003)
- [x] プラン詳細画面 (UC001-004)
- [x] カスタマイズビュー画面 (UC001-005)
- [x] 共同編集画面 (UC002-001)
- [x] 編集競合解決画面 (UC002-002)
- [x] 編集履歴画面 (UC002-003)
- [x] プレビュー画面 (UC002-004)
- [x] 承認ワークフロー画面 (UC002-005)
- [ ] AI プラン生成 API の統合 (`POST /plans/generate`)
- [ ] カスタマイズビューの diff/patch 実装
- [ ] 共同編集ボードの WebSocket 同期、競合解決画面への配線

### 4.4 ポータル・仲裁 ✅ 完了 (フロントエンド)
- [x] ポータルトップ画面 (UC003-001)
- [x] デート情報検索画面 (UC003-002)
- [x] 記事詳細画面 (UC003-003)
- [x] アプリ誘導画面 (UC003-004)
- [x] 利用ガイド画面 (UC003-005)
- [x] 仲裁依頼画面 (UC004-001)
- [x] 状況分析画面 (UC004-002)
- [x] 仲裁提案画面 (UC004-003)
- [x] 関係改善プラン画面 (UC004-004)
- [x] 振り返りレポート画面 (UC004-005)

### 4.5 Date Canvas ✅ 完了 (フロントエンド)
- [x] Date Canvas画面 (UC005-001)
- [ ] Canvas 描画を Fabric.js で構築
- [ ] マップ表示に MapLibre GL を採用、`location` カテゴリをピン化
- [ ] 共有リンク (短縮 URL) を CloudFront Functions で発行

### 4.6 課金管理 ✅ 完了 (フロントエンド)
- [x] 課金管理画面 (UC007-001)
- [x] 機能解放画面 (UC007-002)
- [x] 課金変更通知画面 (UC007-003)
- [x] 課金指標分析画面 (UC007-004)
- [x] サブスクリプション管理画面 (UC007-005)
- [ ] Stripe Customer Portal 連携
- [ ] 任意課金アラートの通知設定 (メール + Slack Webhook)
- [ ] 売上ダッシュボードは BigQuery + Looker Studio Embedding を検討

## 5. リリースノート雛形
```
## CouplePlan v0.1 (2025-01-27)
- 全34画面のフロントエンド実装完了
- プロトタイプとの完全一致を実現
- レスポンシブデザインで全デバイス対応
- 認証系画面 (AUTH-001〜AUTH-004) を実装
- 共通系画面 (COMMON-001〜COMMON-005) を実装
- AIデートプラン提案・生成 (UC001-001〜UC001-005) を実装
- カップル共同デートプラン編集 (UC002-001〜UC002-005) を実装
- ポータル起点統合プラットフォーム (UC003-001〜UC003-005) を実装
- AI喧嘩仲裁・関係修復システム (UC004-001〜UC004-005) を実装
- Date Canvas共同編集ボード (UC005-001) を実装
- 段階的マネタイズ制御 (UC007-001〜UC007-005) を実装
- TypeScript型定義とユーティリティ関数を実装
- インタラクティブ機能 (タブ、モーダル、フォーム、フィルター) を実装
- アクセシビリティ対応を実装
```

## 6. リスク/課題
### フロントエンド実装完了後の課題
- **API統合**: バックエンドAPIとの連携実装
- **AI プラン生成のレイテンシ**: SLA (<4s) を満たすか要検証
- **共同編集の競合解決**: Operational Transform vs CRDT の選択
- **Stripe Webhook**: 内部イベントの冪等性を担保
- **位置情報データ**: 個人情報保護 (同意・削除ポリシー)
- **パフォーマンス最適化**: 画像最適化、コード分割
- **テスト実装**: ユニットテスト、統合テスト

## 7. コミュニケーション
- 定例: 月曜 11:00 (All hands)、木曜 17:00 (技術同期)
- ドキュメント: GitHub + Notion、設計レビューは FigJam
- インシデント: PagerDuty (S2 以上)、Slack #cp-release チャンネル
